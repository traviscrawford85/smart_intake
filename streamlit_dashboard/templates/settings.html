{% extends "base.html" %}
{% block content %}
<h1>API Key Management</h1>
<form method="post" action="/generate_key">
    <label for="display_name">Key Name/Label:</label>
    <input type="text" name="display_name" required>
    <button type="submit">Generate New Key</button>
</form>
{% if api_key %}
    <div style="color:green;">
        <strong>Your new API Key (copy now, not shown again):</strong><br>
        <code>{{ api_key }}</code>
    </div>
{% endif %}
<hr>
<h2>Existing Keys</h2>
<table border="1">
    <tr>
        <th>ID</th>
        <th>Label</th>
        <th>Created</th>
        <th>Status</th>
        <th>Action</th>
    </tr>
    {% for k in keys %}
    <tr>
        <td>{{ k.id }}</td>
        <td>{{ k.display_name }}</td>
        <td>{{ k.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>
            {% if k.revoked %}
                <span style="color:red;">Revoked</span>
            {% else %}
                <span style="color:green;">Active</span>
            {% endif %}
        </td>
        <td>
            {% if not k.revoked %}
            <form method="post" action="/revoke_key" style="display:inline;">
                <input type="hidden" name="key_id" value="{{ k.id }}">
                <button type="submit" onclick="return confirm('Revoke this key?')">Revoke</button>
            </form>
            {% else %}-{% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% endblock %}
